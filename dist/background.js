(()=>{var e={32:(e,r,t)=>{"use strict";t.d(r,{A:()=>n});var s=t(815);"undefined"!=typeof window&&window.addEventListener("message",(e=>{"https://extensionpay.com"===e.origin&&e.source==window&&("fetch-user"!==e.data&&"trial-start"!==e.data||s.runtime.sendMessage(e.data))}),!1);const n=function(e){const r="https://extensionpay.com",t=`${r}/extension/${e}`;function n(e){return new Promise((r=>setTimeout(r,e)))}async function a(e){try{return await s.storage.sync.get(e)}catch(r){return await s.storage.local.get(e)}}async function i(e){try{return await s.storage.sync.set(e)}catch(r){return await s.storage.local.set(e)}}s.management&&s.management.getSelf().then((async e=>{if(!e.permissions.includes("storage")){var r=e.hostPermissions.concat(e.permissions);throw`ExtPay Setup Error: please include the "storage" permission in manifest.json["permissions"] or else ExtensionPay won't work correctly.\n\nYou can copy and paste this to your manifest.json file to fix this error:\n\n"permissions": [\n    ${r.map((e=>`"    ${e}"`)).join(",\n")}${r.length>0?",":""}\n    "storage"\n]\n`}})),a(["extensionpay_installed_at","extensionpay_user"]).then((async e=>{if(e.extensionpay_installed_at)return;const r=e.extensionpay_user,t=r?r.installedAt:(new Date).toISOString();await i({extensionpay_installed_at:t})}));const o=[],g=[];async function m(){var e,n={};if(s.management)e=await s.management.getSelf();else{if(!s.runtime)throw"ExtPay needs to be run in a browser extension context";(e=await s.runtime.sendMessage("extpay-extinfo"))||(e={installType:"update_url"in s.runtime.getManifest()?"normal":"development"})}"development"==e.installType&&(n.development=!0);const a=await fetch(`${t}/api/new-key`,{method:"POST",headers:{Accept:"application/json","Content-type":"application/json"},body:JSON.stringify(n)});if(!a.ok)throw a.status,`${r}/home`;const o=await a.json();return await i({extensionpay_api_key:o}),o}async function l(){const e=await a(["extensionpay_api_key"]);return e.extensionpay_api_key?e.extensionpay_api_key:null}const c=/^\d\d\d\d-\d\d-\d\dT/;async function A(){var e=await a(["extensionpay_user","extensionpay_installed_at"]);const r=await l();if(!r)return{paid:!1,paidAt:null,installedAt:e.extensionpay_installed_at?new Date(e.extensionpay_installed_at):new Date,trialStartedAt:null};const s=await fetch(`${t}/api/user?api_key=${r}`,{method:"GET",headers:{Accept:"application/json"}});if(!s.ok)throw"ExtPay error while fetching user: "+await s.text();const n=await s.json(),m={};for(var[A,d]of Object.entries(n))d&&d.match&&d.match(c)&&(d=new Date(d)),m[A]=d;return m.installedAt=new Date(e.extensionpay_installed_at),m.paidAt&&(!e.extensionpay_user||e.extensionpay_user&&!e.extensionpay_user.paidAt)&&o.forEach((e=>e(m))),m.trialStartedAt&&(!e.extensionpay_user||e.extensionpay_user&&!e.extensionpay_user.trialStartedAt)&&g.forEach((e=>e(m))),await i({extensionpay_user:n}),m}async function d(e,r,t){if(s.windows&&s.windows.create){const n=await s.windows.getCurrent(),a=Math.round(.5*(n.width-r)+n.left),i=Math.round(.5*(n.height-t)+n.top);try{s.windows.create({url:e,type:"popup",focused:!0,width:r,height:t,left:a,top:i})}catch(n){s.windows.create({url:e,type:"popup",width:r,height:t,left:a,top:i})}}else window.open(e,null,`toolbar=no,location=no,directories=no,status=no,menubar=no,width=${r},height=${t},left=450`)}var u=!1;return{getUser:function(){return A()},onPaid:{addListener:function(e){const t=`"content_scripts": [\n                {\n            "matches": ["${r}/*"],\n            "js": ["ExtPay.js"],\n            "run_at": "document_start"\n        }]`,n=s.runtime.getManifest();if(!n.content_scripts)throw`ExtPay setup error: To use the onPaid callback handler, please include ExtPay as a content script in your manifest.json. You can copy the example below into your manifest.json or check the docs: https://github.com/Glench/ExtPay#2-configure-your-manifestjson\n\n        ${t}`;const a=n.content_scripts.find((e=>e.matches.includes(r.replace(":3000","")+"/*")));if(!a)throw`ExtPay setup error: To use the onPaid callback handler, please include ExtPay as a content script in your manifest.json matching "${r}/*". You can copy the example below into your manifest.json or check the docs: https://github.com/Glench/ExtPay#2-configure-your-manifestjson\n\n        ${t}`;if(!a.run_at||"document_start"!==a.run_at)throw`ExtPay setup error: To use the onPaid callback handler, please make sure the ExtPay content script in your manifest.json runs at document start. You can copy the example below into your manifest.json or check the docs: https://github.com/Glench/ExtPay#2-configure-your-manifestjson\n\n        ${t}`;o.push(e)}},openPaymentPage:async function(){d(await async function(){var e=await l();return e||(e=await m()),`${t}?api_key=${e}`}(),500,800)},openTrialPage:async function(e){var r=await l();r||(r=await m());var s=`${t}/trial?api_key=${r}`;e&&(s+=`&period=${e}`),d(s,500,650)},openLoginPage:async function(){var e=await l();e||(e=await m()),d(`${t}/reactivate?api_key=${e}`,500,800)},onTrialStarted:{addListener:function(e){g.push(e)}},startBackground:function(){s.runtime.onMessage.addListener((function(e,r,t){if(console.log("service worker got message! Here it is:",e),"fetch-user"==e)!async function(){if(!u){u=!0;for(var e=await A(),r=0;r<120;++r){if(e.paidAt)return u=!1,e;await n(1e3),e=await A()}u=!1}}();else if("trial-start"==e)A();else if("extpay-extinfo"==e&&s.management)return s.management.getSelf()}))}}}},815:function(e,r){var t,s;"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self&&self,t=function(e){"use strict";if("undefined"==typeof browser||Object.getPrototypeOf(browser)!==Object.prototype){const r="The message port closed before a response was received.",t="Returning a Promise is the preferred way to send a reply from an onMessage/onMessageExternal listener, as the sendResponse will be removed from the specs (See https://developer.mozilla.org/docs/Mozilla/Add-ons/WebExtensions/API/runtime/onMessage)",s=e=>{const s={alarms:{clear:{minArgs:0,maxArgs:1},clearAll:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getAll:{minArgs:0,maxArgs:0}},bookmarks:{create:{minArgs:1,maxArgs:1},get:{minArgs:1,maxArgs:1},getChildren:{minArgs:1,maxArgs:1},getRecent:{minArgs:1,maxArgs:1},getSubTree:{minArgs:1,maxArgs:1},getTree:{minArgs:0,maxArgs:0},move:{minArgs:2,maxArgs:2},remove:{minArgs:1,maxArgs:1},removeTree:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1},update:{minArgs:2,maxArgs:2}},browserAction:{disable:{minArgs:0,maxArgs:1,fallbackToNoCallback:!0},enable:{minArgs:0,maxArgs:1,fallbackToNoCallback:!0},getBadgeBackgroundColor:{minArgs:1,maxArgs:1},getBadgeText:{minArgs:1,maxArgs:1},getPopup:{minArgs:1,maxArgs:1},getTitle:{minArgs:1,maxArgs:1},openPopup:{minArgs:0,maxArgs:0},setBadgeBackgroundColor:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setBadgeText:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setIcon:{minArgs:1,maxArgs:1},setPopup:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setTitle:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},browsingData:{remove:{minArgs:2,maxArgs:2},removeCache:{minArgs:1,maxArgs:1},removeCookies:{minArgs:1,maxArgs:1},removeDownloads:{minArgs:1,maxArgs:1},removeFormData:{minArgs:1,maxArgs:1},removeHistory:{minArgs:1,maxArgs:1},removeLocalStorage:{minArgs:1,maxArgs:1},removePasswords:{minArgs:1,maxArgs:1},removePluginData:{minArgs:1,maxArgs:1},settings:{minArgs:0,maxArgs:0}},commands:{getAll:{minArgs:0,maxArgs:0}},contextMenus:{remove:{minArgs:1,maxArgs:1},removeAll:{minArgs:0,maxArgs:0},update:{minArgs:2,maxArgs:2}},cookies:{get:{minArgs:1,maxArgs:1},getAll:{minArgs:1,maxArgs:1},getAllCookieStores:{minArgs:0,maxArgs:0},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}},devtools:{inspectedWindow:{eval:{minArgs:1,maxArgs:2,singleCallbackArg:!1}},panels:{create:{minArgs:3,maxArgs:3,singleCallbackArg:!0},elements:{createSidebarPane:{minArgs:1,maxArgs:1}}}},downloads:{cancel:{minArgs:1,maxArgs:1},download:{minArgs:1,maxArgs:1},erase:{minArgs:1,maxArgs:1},getFileIcon:{minArgs:1,maxArgs:2},open:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},pause:{minArgs:1,maxArgs:1},removeFile:{minArgs:1,maxArgs:1},resume:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1},show:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},extension:{isAllowedFileSchemeAccess:{minArgs:0,maxArgs:0},isAllowedIncognitoAccess:{minArgs:0,maxArgs:0}},history:{addUrl:{minArgs:1,maxArgs:1},deleteAll:{minArgs:0,maxArgs:0},deleteRange:{minArgs:1,maxArgs:1},deleteUrl:{minArgs:1,maxArgs:1},getVisits:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1}},i18n:{detectLanguage:{minArgs:1,maxArgs:1},getAcceptLanguages:{minArgs:0,maxArgs:0}},identity:{launchWebAuthFlow:{minArgs:1,maxArgs:1}},idle:{queryState:{minArgs:1,maxArgs:1}},management:{get:{minArgs:1,maxArgs:1},getAll:{minArgs:0,maxArgs:0},getSelf:{minArgs:0,maxArgs:0},setEnabled:{minArgs:2,maxArgs:2},uninstallSelf:{minArgs:0,maxArgs:1}},notifications:{clear:{minArgs:1,maxArgs:1},create:{minArgs:1,maxArgs:2},getAll:{minArgs:0,maxArgs:0},getPermissionLevel:{minArgs:0,maxArgs:0},update:{minArgs:2,maxArgs:2}},pageAction:{getPopup:{minArgs:1,maxArgs:1},getTitle:{minArgs:1,maxArgs:1},hide:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setIcon:{minArgs:1,maxArgs:1},setPopup:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setTitle:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},show:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},permissions:{contains:{minArgs:1,maxArgs:1},getAll:{minArgs:0,maxArgs:0},remove:{minArgs:1,maxArgs:1},request:{minArgs:1,maxArgs:1}},runtime:{getBackgroundPage:{minArgs:0,maxArgs:0},getPlatformInfo:{minArgs:0,maxArgs:0},openOptionsPage:{minArgs:0,maxArgs:0},requestUpdateCheck:{minArgs:0,maxArgs:0},sendMessage:{minArgs:1,maxArgs:3},sendNativeMessage:{minArgs:2,maxArgs:2},setUninstallURL:{minArgs:1,maxArgs:1}},sessions:{getDevices:{minArgs:0,maxArgs:1},getRecentlyClosed:{minArgs:0,maxArgs:1},restore:{minArgs:0,maxArgs:1}},storage:{local:{clear:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}},managed:{get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1}},sync:{clear:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}}},tabs:{captureVisibleTab:{minArgs:0,maxArgs:2},create:{minArgs:1,maxArgs:1},detectLanguage:{minArgs:0,maxArgs:1},discard:{minArgs:0,maxArgs:1},duplicate:{minArgs:1,maxArgs:1},executeScript:{minArgs:1,maxArgs:2},get:{minArgs:1,maxArgs:1},getCurrent:{minArgs:0,maxArgs:0},getZoom:{minArgs:0,maxArgs:1},getZoomSettings:{minArgs:0,maxArgs:1},goBack:{minArgs:0,maxArgs:1},goForward:{minArgs:0,maxArgs:1},highlight:{minArgs:1,maxArgs:1},insertCSS:{minArgs:1,maxArgs:2},move:{minArgs:2,maxArgs:2},query:{minArgs:1,maxArgs:1},reload:{minArgs:0,maxArgs:2},remove:{minArgs:1,maxArgs:1},removeCSS:{minArgs:1,maxArgs:2},sendMessage:{minArgs:2,maxArgs:3},setZoom:{minArgs:1,maxArgs:2},setZoomSettings:{minArgs:1,maxArgs:2},update:{minArgs:1,maxArgs:2}},topSites:{get:{minArgs:0,maxArgs:0}},webNavigation:{getAllFrames:{minArgs:1,maxArgs:1},getFrame:{minArgs:1,maxArgs:1}},webRequest:{handlerBehaviorChanged:{minArgs:0,maxArgs:0}},windows:{create:{minArgs:0,maxArgs:1},get:{minArgs:1,maxArgs:2},getAll:{minArgs:0,maxArgs:1},getCurrent:{minArgs:0,maxArgs:1},getLastFocused:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},update:{minArgs:2,maxArgs:2}}};if(0===Object.keys(s).length)throw new Error("api-metadata.json has not been included in browser-polyfill");class n extends WeakMap{constructor(e,r=void 0){super(r),this.createItem=e}get(e){return this.has(e)||this.set(e,this.createItem(e)),super.get(e)}}const a=(r,t)=>(...s)=>{e.runtime.lastError?r.reject(e.runtime.lastError):t.singleCallbackArg||s.length<=1&&!1!==t.singleCallbackArg?r.resolve(s[0]):r.resolve(s)},i=e=>1==e?"argument":"arguments",o=(e,r,t)=>new Proxy(r,{apply:(r,s,n)=>t.call(s,e,...n)});let g=Function.call.bind(Object.prototype.hasOwnProperty);const m=(e,r={},t={})=>{let s=Object.create(null),n={has:(r,t)=>t in e||t in s,get(n,l,c){if(l in s)return s[l];if(!(l in e))return;let A=e[l];if("function"==typeof A)if("function"==typeof r[l])A=o(e,e[l],r[l]);else if(g(t,l)){let r=((e,r)=>function(t,...s){if(s.length<r.minArgs)throw new Error(`Expected at least ${r.minArgs} ${i(r.minArgs)} for ${e}(), got ${s.length}`);if(s.length>r.maxArgs)throw new Error(`Expected at most ${r.maxArgs} ${i(r.maxArgs)} for ${e}(), got ${s.length}`);return new Promise(((n,i)=>{if(r.fallbackToNoCallback)try{t[e](...s,a({resolve:n,reject:i},r))}catch(a){console.warn(`${e} API method doesn't seem to support the callback parameter, falling back to call it without a callback: `,a),t[e](...s),r.fallbackToNoCallback=!1,r.noCallback=!0,n()}else r.noCallback?(t[e](...s),n()):t[e](...s,a({resolve:n,reject:i},r))}))})(l,t[l]);A=o(e,e[l],r)}else A=A.bind(e);else if("object"==typeof A&&null!==A&&(g(r,l)||g(t,l)))A=m(A,r[l],t[l]);else{if(!g(t,"*"))return Object.defineProperty(s,l,{configurable:!0,enumerable:!0,get:()=>e[l],set(r){e[l]=r}}),A;A=m(A,r[l],t["*"])}return s[l]=A,A},set:(r,t,n,a)=>(t in s?s[t]=n:e[t]=n,!0),defineProperty:(e,r,t)=>Reflect.defineProperty(s,r,t),deleteProperty:(e,r)=>Reflect.deleteProperty(s,r)},l=Object.create(e);return new Proxy(l,n)},l=e=>({addListener(r,t,...s){r.addListener(e.get(t),...s)},hasListener:(r,t)=>r.hasListener(e.get(t)),removeListener(r,t){r.removeListener(e.get(t))}});let c=!1;const A=new n((e=>"function"!=typeof e?e:function(r,s,n){let a,i,o=!1,g=new Promise((e=>{a=function(r){c||(console.warn(t,(new Error).stack),c=!0),o=!0,e(r)}}));try{i=e(r,s,a)}catch(e){i=Promise.reject(e)}const m=!0!==i&&((l=i)&&"object"==typeof l&&"function"==typeof l.then);var l;if(!0!==i&&!m&&!o)return!1;return(m?i:g).then((e=>{n(e)}),(e=>{let r;r=e&&(e instanceof Error||"string"==typeof e.message)?e.message:"An unexpected error occurred",n({__mozWebExtensionPolyfillReject__:!0,message:r})})).catch((e=>{console.error("Failed to send onMessage rejected reply",e)})),!0})),d=({reject:t,resolve:s},n)=>{e.runtime.lastError?e.runtime.lastError.message===r?s():t(e.runtime.lastError):n&&n.__mozWebExtensionPolyfillReject__?t(new Error(n.message)):s(n)},u=(e,r,t,...s)=>{if(s.length<r.minArgs)throw new Error(`Expected at least ${r.minArgs} ${i(r.minArgs)} for ${e}(), got ${s.length}`);if(s.length>r.maxArgs)throw new Error(`Expected at most ${r.maxArgs} ${i(r.maxArgs)} for ${e}(), got ${s.length}`);return new Promise(((e,r)=>{const n=d.bind(null,{resolve:e,reject:r});s.push(n),t.sendMessage(...s)}))},x={runtime:{onMessage:l(A),onMessageExternal:l(A),sendMessage:u.bind(null,"sendMessage",{minArgs:1,maxArgs:3})},tabs:{sendMessage:u.bind(null,"sendMessage",{minArgs:2,maxArgs:3})}},p={clear:{minArgs:1,maxArgs:1},get:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}};return s.privacy={network:{"*":p},services:{"*":p},websites:{"*":p}},m(e,x,s)};if("object"!=typeof chrome||!chrome||!chrome.runtime||!chrome.runtime.id)throw new Error("This script should only be loaded in a browser extension.");e.exports=s(chrome)}else e.exports=browser},void 0===(s=t.apply(r,[e]))||(e.exports=s)}},r={};function t(s){var n=r[s];if(void 0!==n)return n.exports;var a=r[s]={exports:{}};return e[s].call(a.exports,a,a.exports,t),a.exports}t.n=e=>{var r=e&&e.__esModule?()=>e.default:()=>e;return t.d(r,{a:r}),r},t.d=(e,r)=>{for(var s in r)t.o(r,s)&&!t.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:r[s]})},t.o=(e,r)=>Object.prototype.hasOwnProperty.call(e,r),(()=>{"use strict";var e=t(32);const r=(0,e.A)("leftwrite-test");chrome.runtime.onMessage.addListener((e=>{"PAYMENT_STATUS_CHANGED"===e.type&&s()}));const s=()=>{return e=void 0,t=void 0,n=function*(){try{const e=yield r.getUser();if(!e.trialStartedAt&&!e.paid)return yield chrome.storage.local.set({isPremium:!1,trialStartedAt:null,needsPayment:!1,isNewUser:!0,analysisCount:0}),!1;const t=new Date,s=e.trialStartedAt&&t.getTime()-new Date(e.trialStartedAt).getTime()<6048e5,n=e.paid||s,a=!n&&e.trialStartedAt;return yield chrome.storage.local.set({isPremium:n,trialStartedAt:e.trialStartedAt,needsPayment:a,isNewUser:!1,analysisCount:s?0:(yield chrome.storage.local.get("analysisCount")).analysisCount||0}),Boolean(n)}catch(e){return console.error("Error checking subscription:",e),yield chrome.storage.local.set({isPremium:!1,needsPayment:!1,analysisCount:0}),!1}},new((s=void 0)||(s=Promise))((function(r,a){function i(e){try{g(n.next(e))}catch(e){a(e)}}function o(e){try{g(n.throw(e))}catch(e){a(e)}}function g(e){var t;e.done?r(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(i,o)}g((n=n.apply(e,t||[])).next())}));var e,t,s,n};var n=function(e,r,t,s){return new(t||(t=Promise))((function(n,a){function i(e){try{g(s.next(e))}catch(e){a(e)}}function o(e){try{g(s.throw(e))}catch(e){a(e)}}function g(e){var r;e.done?n(e.value):(r=e.value,r instanceof t?r:new t((function(e){e(r)}))).then(i,o)}g((s=s.apply(e,r||[])).next())}))};const a=(0,e.A)("leftwrite-test");a.startBackground(),a.onTrialStarted.addListener((()=>n(void 0,void 0,void 0,(function*(){console.log("Trial started!"),yield chrome.storage.local.set({isNewUser:!1,trialStartedAt:(new Date).toISOString()}),yield s()})))),chrome.runtime.onInstalled.addListener((()=>n(void 0,void 0,void 0,(function*(){const e=yield a.getUser();yield chrome.storage.local.set({isPremium:!1,trialStartedAt:e.trialStartedAt||null,isNewUser:!e.trialStartedAt&&!e.paid})})))),a.onPaid.addListener((e=>{console.log("Payment received!",e),chrome.storage.local.set({isPremium:!0,needsPayment:!1})})),a.getUser().then((e=>{console.log("User subscription status:",e.paid)})).catch((e=>{console.error("Error getting user:",e)}))})()})();